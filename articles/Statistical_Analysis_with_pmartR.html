<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistical Analysis with the `pmartR` Package • pmartR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Statistical Analysis with the `pmartR` Package">
<meta property="og:description" content="pmartR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmartR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Quality_Control_with_pmartR.html">Quality Control and Normalization of Peptide Data with the `pmartR` Package</a>
    </li>
    <li>
      <a href="../articles/Statistical_Analysis_with_pmartR.html">Statistical Analysis with the `pmartR` Package</a>
    </li>
    <li>
      <a href="../articles/Trelliscope_Vignette.html">Using Trelliscope Functions with pmartR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pmartR/pmartR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Statistical Analysis with the <code>pmartR</code> Package</h1>
                        <h4 data-toc-skip class="author">Bryan Stanfill, Kelly Stratton, Lisa Bramer</h4>
            
            <h4 data-toc-skip class="date">2022-10-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pmartR/pmartR/blob/HEAD/vignettes/Statistical_Analysis_with_pmartR.Rmd" class="external-link"><code>vignettes/Statistical_Analysis_with_pmartR.Rmd</code></a></small>
      <div class="hidden name"><code>Statistical_Analysis_with_pmartR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>pmartR</code> package includes functions to analyze omics data using the most recent statistical methods. Qualitative and quantitative differences in abundance data are tested using the IMD-ANOVA method described in <span class="citation">Webb-Robertson et al. (2010)</span>. Our IMD-ANOVA functionality can handle omics datasets with various experimental designs, including up to two grouping factors with or without additional covariate information. The data can be paired or not.</p>
<p>The functionality of the <code>pmartR</code> package will be illustrated with peptide data available from the <code>pmartRdata</code> package called <code>pep_object</code>. In a nutshell, the <code>pep_object</code> object is a list of length three of the class <code>pepData</code>. The <code>e_data</code> element contains all of the peptide abundance data, the <code>f_data</code> object contains sample information and the <code>e_meta</code> object contains meta information related to the peptides in the dataset. See the <code><a href="https://rdrr.io/pkg/pmartRdata/man/pmartRdata.html" class="external-link">?pmartRdata</a></code> for more on this data set.</p>
<p>The <code><a href="../reference/imd_anova.html">imd_anova()</a></code> function is a wrapper for the <code><a href="../reference/anova_test.html">anova_test()</a></code> and <code><a href="../reference/imd_test.html">imd_test()</a></code> functions. Below, descriptions of <code><a href="../reference/anova_test.html">anova_test()</a></code> and <code><a href="../reference/imd_test.html">imd_test()</a></code> functionality are followed by a description of <code><a href="../reference/imd_anova.html">imd_anova()</a></code> functionality.</p>
</div>
<div class="section level2">
<h2 id="analysis-of-variance">Analysis of Variance<a class="anchor" aria-label="anchor" href="#analysis-of-variance"></a>
</h2>
<p>Quantitative test for differential abundance of pan-omic data is accomplished using the function <code><a href="../reference/anova_test.html">anova_test()</a></code> which implements an analysis of variance (ANOVA) to each biomolecule. <a href="https://cran.r-project.org/web/packages/Rcpp/index.html" class="external-link"><code>Rcpp</code></a> is used to speed up computation (<span class="citation">Eddelbuettel (2013)</span>). Different ANOVA implementations are applied depending on the complexity of the supplied data. For example, if only two groups are supplied then ANOVA reduces to a two sample <span class="math inline">\(t\)</span>-test that assumes equal variance for the two groups. Alternatively, if two groups are present and a covariate correction is required then the effect of the covariates is removed using a reduced maximum likelihood approach. After the covariate correction is applied, a two-factor ANOVA is used to detect difference between all combinations of groups or between main effects as appropriate. Details on generalizations to these two approaches are given in the next two subsections.</p>
<div class="section level3">
<h3 id="one-group">One-group<a class="anchor" aria-label="anchor" href="#one-group"></a>
</h3>
<p>If there is only one grouping factor and that factor has more than two levels, then a one-way ANOVA tests for quantitative differences between the groups. Let <span class="math inline">\(y_{ik}\)</span> represent the biomolecue abundance for observation <span class="math inline">\(k=1,\dots,n_i\)</span> in group <span class="math inline">\(i=1,\dots,m\)</span> on the log base 2 scale then we assume <span class="math display">\[\begin{equation}
y_{ik}=\mu_i+e_{ik},
\label{eq:one_group}
\end{equation}\]</span> where <span class="math inline">\(\mu_i\)</span> represents the mean abundance of group <span class="math inline">\(i\)</span> (on the log-scale) and <span class="math inline">\(e_{ik}\)</span> are the error terms that are assumed to be independent and identically distributed (iid) according to the normal distribution with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>The code below will group the peptide data by Condition, which is a categorical variable with two levels: “Infection” and “Mock”. Then the <code>anova_test</code> function fits the model described above and tests for differential abundance between Infection and Mock for every peptide.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_designation.html">group_designation</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, main_effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Condition"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myfilt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imdanova_filter.html">imdanova_filter</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span><span class="op">)</span></span>
<span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/applyFilt.html">applyFilt</a></span><span class="op">(</span>filter_object <span class="op">=</span> <span class="va">myfilt</span>, omicsData <span class="op">=</span> <span class="va">pep_object</span>, min_nonmiss_anova <span class="op">=</span> <span class="fl">2</span>, min_nonmiss_gtest <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">all_pairwise_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imd_anova.html">imd_anova</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, test_method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>anova_test</code> returns a length four list. The first element is called <code>Results</code> which contains the best linear unbiased estimators of <span class="math inline">\(\mu_i\)</span> in the rows called <code>Mean_i</code> where <code>i</code> is replaced by the group name supplied as an attribute of the <code>omicsData</code> argument, an estimate <span class="math inline">\(\sigma^2\)</span> in the column <code>Variance</code>, the global <span class="math inline">\(F\)</span>-test statistic and <span class="math inline">\(p\)</span>-value in the <code>F_Statistic</code> and <code>p_value</code> columns, respectively. Because every group is assumed to have the same variance, <code>Variance</code> is the maximum likelihood estimators. The remaining three elements, <code>Fold_changes</code>, <code>Fold_change_pvalues</code> and <code>Flags</code>, contain the fold change estimates, <span class="math inline">\(p\)</span>-values and indicators of significance, respectively, for all pairwise comparisons of groups. Each column of the <code>Flags</code> element is a <span class="math inline">\(\pm1\)</span> or 0 depending on if that fold change was or was not statistically significant from zero, respectively, according to the <span class="math inline">\(p\)</span>-values contained in the <code>Fold_change_pvalues</code> <code>data.frame</code> and the specificed <span class="math inline">\(p\)</span>-value threshold set by the <code>pval_thresh</code> argument. A value of <span class="math inline">\(-1\)</span> implies the control group is significantly under expressed compared to the test group, and the converse is true for <span class="math inline">\(+1\)</span>.</p>
<p>The <span class="math inline">\(p\)</span>-values associated with each group comparison can be adjusted to multiple comparisons. A detailed look at the available <span class="math inline">\(p\)</span>-value adjustment methods and when they should be applied are discussed later in this vignette, but the use of the Tukey multiple comparison method is illustrated in the following.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_pairwise_results_adjusted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imd_anova.html">imd_anova</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, test_method <span class="op">=</span> <span class="st">"anova"</span>, pval_adjust_a <span class="op">=</span> <span class="st">"tukey"</span><span class="op">)</span></span></code></pre></div>
<p>By default, all pairwise comparisons are made. Custom comparisons can by defined by passing a <code>data.frame</code> to the <code>comparisons</code> argument with column names “Test” and “Control”. In the below the, we modify the groupings to demonstrate use of all pairwise comparisons. Now, group “A” is treated as the control group and the remaining groups are compared to it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pep_object</span><span class="op">$</span><span class="va">f_data</span><span class="op">$</span><span class="va">Condition2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_designation.html">group_designation</a></span><span class="op">(</span><span class="va">pep_object</span>, main_effects <span class="op">=</span> <span class="st">"Condition2"</span><span class="op">)</span></span>
<span><span class="va">one_vs_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fl">3</span><span class="op">)</span>,Test<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">one_vs_all_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imd_anova.html">imd_anova</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, test_method <span class="op">=</span> <span class="st">"anova"</span>, comparisons <span class="op">=</span> <span class="va">one_vs_all</span><span class="op">)</span></span></code></pre></div>
<p>If the grouping variable has only two levels, <span class="math inline">\(m=2\)</span>, then a Welch’s <span class="math inline">\(t\)</span>-test is performed instead of an ANOVA. That is, the model defined in Equation (\ref{eq:one_group}) is still fit, but the two groups of the grouping factor are allowed to have different variances. In particular, the error terms <span class="math inline">\(e_{ik}\)</span> are assumed to be independently distributed according to the normal distribution with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2_i\)</span>. To determine if the biomolecules are differentially expressed, <span class="math inline">\(p\)</span>-values are derived from a <span class="math inline">\(t\)</span>-distribution with degrees of freedom approximated by the Satterthwaite equation. The value for <code>Variance</code>, which is not a pooled variance estimates, scaled by the Satterthwaite approximate degrees of freedom. To illustrate this the data are grouped by Condition, then fit with <code><a href="../reference/anova_test.html">anova_test()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/group_designation.html">group_designation</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, main_effects <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Condition"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">all_pairwise_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imd_anova.html">imd_anova</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, test_method <span class="op">=</span> <span class="st">"anova"</span><span class="op">)</span></span></code></pre></div>
<p>When this model is fit, it is imperative the researcher check the assumptions of the model. In particular for the <span class="math inline">\(m&gt;2\)</span> case, the residuals <span class="math inline">\(\hat e_{ik}=y_{ik}-\hat \mu_i\)</span> are assumed to be independent, normally distributed and have a common variance across groups. The appropriateness of this assumption can be assessed using quantile-quantile plots and comparisons of each group’s variance.</p>
</div>
<div class="section level3">
<h3 id="two-groups">Two-groups<a class="anchor" aria-label="anchor" href="#two-groups"></a>
</h3>
<p>Next we consider the case where there are two grouping factors again in the context of biomolecule abundance. Let <span class="math inline">\(y_{ijk}\)</span> represent the biomolecule abundance for observation <span class="math inline">\(k=1,\dots,n_{ij}\)</span> in group <span class="math inline">\(i=1,\dots,m\)</span> and group <span class="math inline">\(j=1,\dots,p\)</span> on the log base 2 scale then we assume <span class="math display">\[\begin{equation}
y_{ijk}=\mu_i+\alpha_j+\gamma_{ij}+e_{ijk},
\label{eq:full_model}
\end{equation}\]</span> where <span class="math inline">\(\mu_i+\alpha_j+\gamma_{ij}\)</span> represents the mean abundance for an observation in <span class="math inline">\(i\)</span>th first group and <span class="math inline">\(j\)</span>th second group which have marginal means <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\alpha_j\)</span>, respectively. Finally, <span class="math inline">\(\gamma_{ij}\)</span> is the interaction effect of group <span class="math inline">\(ij\)</span>, and <span class="math inline">\(e_{ijk}\)</span> are the error terms that are assumed to be iid according to the normal distribution with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>For each biomolecule, the <code><a href="../reference/anova_test.html">anova_test()</a></code> function automatically tests if the <span class="math inline">\(\gamma_{ij}\)</span> effect is statistically significant from zero using a full and reduced model <span class="math inline">\(F\)</span>-test. That is, in addition to the model above, the reduced model <span class="math display">\[\begin{equation}
y_{ijk}=\mu_i+\alpha_j+e_{ijk}
\label{eq:red_model}
\end{equation}\]</span> is also fit and the test statistic <span class="math display">\[F^*=\frac{MSE_F}{(SSE_R-SSE_F)/(df_R-df_F)}\]</span> is computed where <span class="math inline">\(MSE_\cdot\)</span> and <span class="math inline">\(df_\cdot\)</span> are the mean square error and degrees of freedom for the full (F; \ref{eq:full_model}) or reduced (R; \ref{eq:red_model}) model, respectively. A <span class="math inline">\(p\)</span>-value is computed based on <span class="math inline">\(F^*\)</span> as <span class="math inline">\(p=P(F^*&gt;F_{a,b})\)</span> where <span class="math inline">\(F_{a,b}\)</span> is compared to an <span class="math inline">\(F\)</span> distribution with degrees of freedom <span class="math inline">\(a=df_F\)</span> and <span class="math inline">\(b=df_R-df_F\)</span>. If <span class="math inline">\(p&lt;0.05\)</span> then there is significant evidence to reject the null hypothesis that the reduced model \eqref{eq:red_model} is adequate and the full model \eqref{eq:full_model} is used to test for group differences. Conversely, if <span class="math inline">\(p\geq 0.05\)</span> then there is not enough evidence to reject the null hypothesis and the reduced model \eqref{eq:red_model} is used.</p>
<p>Regardless of if the full or reduced model is used, both assume that the residuals are independent and normally distributed with a common variance for all groups. These assumptions must be checked before the results of the model are used to assess differential abundance.</p>
</div>
<div class="section level3">
<h3 id="covariate-adjustment">Covariate adjustment<a class="anchor" aria-label="anchor" href="#covariate-adjustment"></a>
</h3>
<p>If, in addition to a single grouping factor, there are covariates that are to be accounted for when testing for differential abundance then a linear model of the form <span class="math display">\[\begin{equation}
y_{ik}=\mu_i+\mathbf{x}_{ik}^\top \beta +u_{ik}
\label{eq:covar_adj}
\end{equation}\]</span> is fit to the transformed abundance data <span class="math inline">\(y_{ik}\)</span> where <span class="math inline">\(\mu_i\)</span> is the marginal mean of group <span class="math inline">\(i\)</span>, <span class="math inline">\(\mathbf{x}_{ik}\)</span> is a vector of covariates for observation <span class="math inline">\(k\)</span> in group <span class="math inline">\(i\)</span>, <span class="math inline">\(\mathbf{\beta}\)</span> is the corresponding vector of parameters to be estimated and <span class="math inline">\(u_{ik}\)</span> are the error terms. An analogous model can be fit when there are two grouping factors of interest. If one of the covariates is colinear with a grouping variable then that covariate is removed from the model, that is, priority is given to the grouping variable over the covariate.</p>
<p>In practice, the covariate adjustment is applied then the one-factor ANOVA model is fit to the covariate adjusted data. That is, after the vector of parameters <span class="math inline">\(\mathbf{\beta}\)</span> in  is estimated, the response <span class="math inline">\(y_{ik}\)</span> in  is replaced with <span class="math inline">\(y_{ik}^*=y_{ik}-\mathbf{x}_{ik}^\top\mathbf{\beta}\)</span>. Though this results in the marginal group means <span class="math inline">\(\mu_i\)</span> being estimated multiple times, it makes the workflow smoother.</p>
</div>
</div>
<div class="section level2">
<h2 id="test-for-independence-of-missing-data">Test for Independence of Missing Data<a class="anchor" aria-label="anchor" href="#test-for-independence-of-missing-data"></a>
</h2>
<p>In the event that there aren’t enough data to test for a quantitative difference in abundance between groups, one could still test for a <em>qualitative</em> difference in groups using the independence of missing data (IMD) test. This is often the case for proteomics data where several peptide or proteins could have missing data for one of several reasons. The idea is to assess if there are more missing data in one group compared to another. If there are an adequate number of non-missing data available, then the <span class="math inline">\(chi^2\)</span> test of independence can be used. This assumption often fails, however, so a modified version of the <span class="math inline">\(chi^2\)</span> test, called the <span class="math inline">\(G\)</span>-test, should be used.</p>
<p>The test statistic associated with the IMD test for each biomolecule is given by <span class="math display">\[\begin{equation}
G=2\sum_{k=1}^K\left[C_{Ok}\ln\left(\frac{C_{Ok}}{E_{Ok}}\right)+C_{Ak}\ln\left(\frac{C_{Ak}}{E_{Ak}}\right) \right]
\label{eq:gtest}
\end{equation}\]</span> where <span class="math inline">\(C_{Ok}\)</span> and <span class="math inline">\(E_{Ok}\)</span> are the observed and expected number of non-missing values for group <span class="math inline">\(k\)</span>, respectively. The quantities <span class="math inline">\(C_{Ak}\)</span> <span class="math inline">\(E_{Ak}\)</span> are similarly defined for the missing (absent) values. Further, the expected number of non-missing values is <span class="math inline">\(E_{Ok}=(m_On_k)/N\)</span> where <span class="math inline">\(n_k\)</span> is the number of samples associated with group <span class="math inline">\(k\)</span>, <span class="math inline">\(N\)</span> is the total number of samples and <span class="math inline">\(m_O\)</span> is the number of samples with this biomolecule missing.</p>
<p>The function <code><a href="../reference/imd_test.html">imd_test()</a></code> will perform the test for missing data. The arguments passed to <code><a href="../reference/imd_test.html">imd_test()</a></code> are the same as those for <code><a href="../reference/anova_test.html">anova_test()</a></code> and the results object returned by <code><a href="../reference/imd_test.html">imd_test()</a></code> is of the same class as <code><a href="../reference/anova_test.html">anova_test()</a></code>. A list of four items is returned:</p>
<ol style="list-style-type: decimal">
<li>
<code>Results</code> - the results of the global IMD test, including biomolecue identifier, count of observed and missing observations, the <span class="math inline">\(G\)</span>-statistic and corresponding <span class="math inline">\(p\)</span>-value. This “global” <span class="math inline">\(G\)</span>-statistic determines if there is a qualitative difference between any of the groups.</li>
<li>
<code>Gstats</code> - <span class="math inline">\(G\)</span>-statistics computed for each of the comparisons defined by the <code>comparison</code> argument</li>
<li>
<code>Pvalues</code> - <span class="math inline">\(p\)</span>-values associated with the <span class="math inline">\(G\)</span>-statistics in the <code>Gstats</code> <code>data.frame</code>
</li>
<li>
<code>Flags</code> - Flags (<span class="math inline">\(\pm 2\)</span>) to indicate for which biomoleuces the groups are qualitative different as measured by the IMD test. A positive value indicates the control group had more missing data than the test group; the opposite is true for negative flags.</li>
</ol>
</div>
<div class="section level2">
<h2 id="imd-anova-test-for-differential-abundance">IMD-ANOVA Test for Differential Abundance<a class="anchor" aria-label="anchor" href="#imd-anova-test-for-differential-abundance"></a>
</h2>
<p>The <code><a href="../reference/imd_anova.html">imd_anova()</a></code> function is used to implement the IMD test, ANOVA test, or combined IMD-ANOVA test. If the combined test is implemented, then the IMD and ANOVA tests are implemented using <code><a href="../reference/imd_test.html">imd_test()</a></code> and <code><a href="../reference/anova_test.html">anova_test()</a></code>, respectively, then the results combined such that the ANOVA results are given priority because the ANOVA results are widely preferred, but IMD results are preferred to nothing.</p>
<ul>
<li>For reporting p-values when combining the IMD and ANOVA tests,
<ul>
<li>If ANOVA p-value but no g-test p-value, report ANOVA p-value</li>
<li>If g-test p-value but no ANOVA p-value, report g-test p-value</li>
<li>If neither, report NA</li>
<li>If both but neither is significant, report ANOVA</li>
<li>If both but ANOVA is significant, report ANOVA</li>
<li>If both but g-test is significant, report g-test</li>
</ul>
</li>
</ul>
<p>The same decision process is applied to the final flags as well.</p>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<p>The <code><a href="../reference/imd_anova.html">imd_anova()</a></code> function returns an object of class <code>statRes</code> that is a list of three items in addition to some attributes. The list is comprised of:</p>
<ol style="list-style-type: decimal">
<li>
<code>Full_Results</code> - a <code>data.frame</code> with columns for the group means, group counts of non missing data, an estimate of the common variance and a few other things (<em>update when this is finalize</em>).<br>
</li>
<li>
<code>Flags</code> - a <code>data.frame</code> of flags that indicate which biomolecules were significant at the specified <span class="math inline">\(p\)</span>-value threshold (<code>pval_thresh</code>) for each comparison.<br>
</li>
<li>
<code>P_values</code> - a <code>data.frame</code> that contains the <span class="math inline">\(p\)</span>-values associated with each biomolecule and comparison evaluated.</li>
</ol>
<p>The <code>statRes</code> object also consists of several attributes which specify the methods used to arrive at the results. This way, the results object is self-contained and can be passed to other functions for further analysis with ease. In particular, the attributes are</p>
<ul>
<li>
<code>group_DF</code> - <code>data.frame</code> defining which samples are associated with which groups</li>
<li>
<code>comparisons</code> - <code>data.frame</code> defining the comparisons that were tested</li>
<li>
<code>number_significant</code> - <code>data.frame</code> giving the number of significant biomolecules (up and down) for each comparison</li>
<li>
<code>statistical_test</code> - character string giving the statistical test(s) run</li>
<li>
<code>adjustment_method</code> - character string giving the adjustment for multiple comparisons that was used; NA if none was used</li>
<li>
<code>pval_thresh</code> - the numeric value that was an input to <code><a href="../reference/anova_test.html">anova_test()</a></code>
</li>
</ul>
<p>Several methods are defined for objects of class <code>statRes</code> including <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, which are discussed more in depth in a later section.</p>
</div>
<div class="section level3">
<h3 id="methods-for-results-objects">Methods for Results Objects<a class="anchor" aria-label="anchor" href="#methods-for-results-objects"></a>
</h3>
<p>Special functions are available for objects of class <code>statRes</code> including <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. Due to the typical size the <code>statRes</code> objects, only the head of each element in a <code>statRes</code> object is printed along with the summarized attributes; use <code><a href="https://rdrr.io/r/base/print.default.html" class="external-link">print.default()</a></code> to see the full object. The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> functions prints the type of test that was run, any adjustments that were made, the <span class="math inline">\(p\)</span>-value threshold used to define significance and a table that summarizes the number of significant biomolecules (up or down) for each comparison. See below for an illustration.</p>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function can be used to produce any subset of the following four plots specified by the <code>plot_type</code> argument. If not <code>plot_type</code> is supplied, then all four are created, otherwise on the subset specified is produced.</p>
<ul>
<li>
<code>"bar"</code> - shows the number of significant biomolecules grouped by comparisons</li>
<li>
<code>"volcano"</code> - a plot of the <span class="math inline">\(p\)</span>-value by the fold-change estimate differentiated by test and faceted by comparison</li>
<li>
<code>"heatmap"</code> - illustrates the fold changes for the statistically significant biomolecules (only available if more than one comparison is done)</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stat_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imd_anova.html">imd_anova</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, test_method <span class="op">=</span> <span class="st">"combined"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stat_results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Type of test: combined </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple comparison adjustment ANOVA: none </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multiple comparison adjustment G-test: none </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## p-value threshold: 0.05 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of significant biomolecules by comparison.  Columns specify fold change direction and type of test:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##          Comparison Total:Positive Total:Negative Positive:ANOVA Negative:ANOVA</span></span>
<span><span class="co">## 1 Infection_vs_Mock           1491           6416            466           4542</span></span>
<span><span class="co">##   Positive:G-test Negative:G-test</span></span>
<span><span class="co">## 1            1025            1874</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">stat_results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## statRes</span></span>
<span><span class="co">##       Mass_Tag_ID Count_Infection Count_Mock Mean_Infection Mean_Mock</span></span>
<span><span class="co">## 1            1047               9          3       24.00732  25.38371</span></span>
<span><span class="co">## 2            1055               8          3       26.37405  27.44310</span></span>
<span><span class="co">## 3            1104               9          3       31.00451  29.96671</span></span>
<span><span class="co">## 4            1110               8          3       21.98179  22.63302</span></span>
<span><span class="co">## 5            ----            ----       ----           ----      ----</span></span>
<span><span class="co">## 13538   258546088               2          2       25.44738  26.43384</span></span>
<span><span class="co">## 13539   292982935               2          2       16.25824  16.96613</span></span>
<span><span class="co">## 13540   321896650               2          2       19.75512  20.52970</span></span>
<span><span class="co">## 13541   391590766               2          2       24.37726  24.91279</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stat_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="Statistical_Analysis_with_pmartR_files/figure-html/statres-1.png" width="960"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stat_results</span>, plot_type <span class="op">=</span> <span class="st">"volcano"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Statistical_Analysis_with_pmartR_files/figure-html/statres-2.png" width="960"></p>
<p>##<span class="math inline">\(p\)</span>-value Adjustment Methods</p>
<p>If several comparisons are being made then it is a good idea to adjust the <span class="math inline">\(p\)</span>-values in order to control the false positive rate. Currently <span class="math inline">\(p\)</span>-value adjustments are made at the biomolecule level (i.e., adjustments are made for the number of groups being compared), but adjustments across biomolecules will be added in the near future. The available <span class="math inline">\(p\)</span>-value adjustments are described in the following table. The “Appropriate Comparison” column refers to which correction method is preferred based on the type of comparisons being made, i.e, all pairwise or case-to-control. Check marks in the “ANOVA?” and “IMD?” columns indicate if that correction method is appropriate for ANOVA or IMD comparisons.</p>
<table class="table">
<thead><tr class="header">
<th>Method Name</th>
<th>Appropriate Comparison</th>
<th>ANOVA</th>
<th>IMD</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Bonferroni</td>
<td>Both</td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
</tr>
<tr class="even">
<td>Dunnett</td>
<td>Case-vs-control</td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td>Holm</td>
<td>Both</td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
</tr>
<tr class="even">
<td>Tukey</td>
<td>All pairwise</td>
<td><span class="math inline">\(\sqrt{}\)</span></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rcpp_book" class="csl-entry">
Eddelbuettel, Dirk. 2013. <em>Seamless <span>R</span> and <span>C++</span> Integration with <span>Rcpp</span></em>. New York: Springer.
</div>
<div id="ref-webb2010combined" class="csl-entry">
Webb-Robertson, Bobbie-Jo M, Lee Ann McCue, Katrina M Waters, Melissa M Matzke, Jon M Jacobs, Thomas O Metz, Susan M Varnum, and Joel G Pounds. 2010. <span>“Combined Statistical Analyses of Peptide Intensities and Peptide Occurrences Improves Identification of Significant Peptides from MS-Based Proteomics Data.”</span> <em>Journal of Proteome Research</em> 9 (11): 5748–56.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lisa Bramer, Kelly Stratton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
